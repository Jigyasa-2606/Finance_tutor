<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance AI Assistant</title>
  <style>
    /* ---------- Base Styles ---------- */
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Inter', system-ui, sans-serif;
      background:linear-gradient(135deg,#00c6ff 0%,#00736d 100%);
      min-height:100vh; padding:20px;
      display:flex; justify-content:center; align-items:flex-start;
      color:#222;
    }
    .container {
      display:grid; grid-template-columns:1fr 1fr; gap:25px;
      max-width:1400px; width:100%; backdrop-filter:blur(12px);
    }
    .panel {
      background:rgba(255,255,255,0.15);
      border:1px solid rgba(255,255,255,0.25);
      border-radius:25px; box-shadow:0 20px 50px rgba(0,0,0,0.25);
      overflow:hidden; display:flex; flex-direction:column;
      height:620px; color:white;
      transition:transform .3s ease, box-shadow .3s ease;
    }
    .panel:hover { transform:translateY(-5px); box-shadow:0 25px 60px rgba(0,0,0,0.35); }
    .panel-header {
      padding:20px; background:rgba(255,255,255,0.2);
      font-size:22px; font-weight:600;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,0.3);
    }
    .status { font-size:14px; opacity:0.8; }
    .status.ok{color:#10b981;} .status.offline{color:#ef4444;}
    /* ---------- Chat ---------- */
    #chatMessages{flex:1;overflow-y:auto;padding:20px;scrollbar-width:thin;}
    .message{display:flex;margin-bottom:15px;animation:fadeIn .4s ease;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
    .message-content{
      padding:12px 18px;border-radius:18px;max-width:70%;line-height:1.5;
      word-wrap:break-word;white-space:pre-wrap;font-size:15px;
    }
    .message.user{justify-content:flex-end;}
    .message.user .message-content{
      background:rgba(0,191,165,0.9);color:#fff;
      box-shadow:0 4px 15px rgba(0,191,165,0.5);
    }
    .message.bot .message-content{
      background:rgba(255,255,255,0.2);color:#f8f9ff;backdrop-filter:blur(10px);
    }
    .loading{display:flex;gap:6px;align-items:center;padding:10px;}
    .loading-dot{width:8px;height:8px;border-radius:50%;background:#fff;animation:bounce 1.4s infinite ease-in-out both;}
    .loading-dot:nth-child(1){animation-delay:-.32s;}
    .loading-dot:nth-child(2){animation-delay:-.16s;}
    @keyframes bounce{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}
    .chat-input-area{
      padding:20px;background:rgba(255,255,255,0.2);
      border-top:1px solid rgba(255,255,255,0.3);
      display:flex;gap:10px;align-items:center;
    }
    .chat-input-area input{
      flex:1;padding:12px 18px;border:none;border-radius:25px;
      font-size:15px;background:rgba(255,255,255,0.8);outline:none;color:#333;
    }
    .btn{
      border:none;padding:12px 24px;border-radius:25px;
      font-weight:600;cursor:pointer;
      background:linear-gradient(135deg,#00bfa5,#00796b);
      color:white;transition:all .3s;
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,191,165,0.4);}
    /* Mic button */
    .mic-btn{
      border:none;border-radius:50%;width:46px;height:46px;
      background:rgba(255,255,255,0.8);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;transition:all .3s;
    }
    .mic-btn:hover{background:rgba(255,255,255,1);}
    .mic-btn.active{background:#00bfa5;color:white;box-shadow:0 0 15px rgba(0,191,165,0.7);}
    .mic-icon{font-size:22px;}
    /* ---------- Tracker ---------- */
    .tracker-content{flex:1;overflow-y:auto;padding:20px;color:#fff;}
    .tracker-form{
      background:rgba(255,255,255,0.15);border-radius:15px;padding:20px;margin-bottom:20px;
      backdrop-filter:blur(12px);
    }
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;}
    input,select{border:none;padding:12px;border-radius:12px;font-size:14px;
      background:rgba(255,255,255,0.8);color:#333;}
    .summary-cards{display:flex;justify-content:space-between;gap:15px;}
    .summary-card{
      flex:1;text-align:center;padding:20px;border-radius:15px;
      background:linear-gradient(135deg,#009688,#00796b);
      box-shadow:0 10px 30px rgba(0,0,0,0.3);color:white;
    }
    .summary-card h3{font-size:16px;opacity:0.85;}
    .summary-card .amount{font-size:26px;font-weight:bold;}
    .transaction-list{margin-top:20px;background:rgba(255,255,255,0.15);
      border-radius:15px;padding:15px;max-height:250px;overflow-y:auto;}
    .transaction-item{
      background:rgba(255,255,255,0.2);padding:12px;border-radius:10px;
      display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;
    }
    .transaction-type.income{color:#10b981;}
    .transaction-type.expense{color:#ef4444;}
    .transaction-amount.income{color:#10b981;}
    .transaction-amount.expense{color:#ef4444;}
    .delete-btn{
      background:#ef4444;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;
    }
    .delete-btn:hover{background:#dc2626;}
    @media(max-width:968px){.container{grid-template-columns:1fr;}.panel{height:auto;}}
  </style>
</head>
<body>
  <div class="container">
    <!-- Chatbot Panel -->
    <div class="panel">
      <div class="panel-header">
        <span>Finance AI Assistant </span>
        <span id="status" class="status offline">‚óè Offline</span>
      </div>
      <div id="chatMessages"></div>
      <div class="chat-input-area">
        <input id="chatInput" placeholder="Ask about investments, stocks, or budgeting..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button class="mic-btn" id="micBtn" title="Speak"><span class="mic-icon">üé§</span></button>
        <button class="btn" onclick="sendMessage()">Send</button>
      </div>
    </div>

    <!-- Tracker Panel -->
    <div class="panel">
      <div class="panel-header">Smart Finance Tracker</div>
      <div class="tracker-content">
        <div class="tracker-form">
          <div class="form-row">
            <input type="text" id="description" placeholder="Description">
            <input type="number" id="amount" placeholder="Amount">
          </div>
          <div class="form-row">
            <select id="type">
              <option value="income">Income</option>
              <option value="expense">Expense</option>
            </select>
            <input type="date" id="date">
          </div>
          <button class="btn" onclick="addTransaction()" style="width:100%">Add Transaction</button>
        </div>
        <div class="summary-cards">
          <div class="summary-card"><h3>Total Income</h3><div class="amount" id="totalIncome">‚Çπ0</div></div>
          <div class="summary-card"><h3>Total Expense</h3><div class="amount" id="totalExpense">‚Çπ0</div></div>
        </div>
        <h3 style="margin-top:20px;">Balance: <span id="balance">‚Çπ0</span></h3>
        <div class="transaction-list" id="transactionList"></div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "http://localhost:5000";
    const statusEl = document.getElementById("status");
    document.getElementById("date").valueAsDate = new Date();

    async function checkHealth(){
      try{
        const res = await fetch(`${API_URL}/health`);
        const data = await res.json();
        if(data.chatbot_ready||data.gemini_ready){
          statusEl.textContent="‚óè Online";
          statusEl.className="status ok";
        }else throw new Error();
      }catch{
        statusEl.textContent="‚óè Offline";
        statusEl.className="status offline";
      }
    }
    checkHealth(); setInterval(checkHealth,10000);

    // ---- Chat Logic ----
    const chatMessages=document.getElementById("chatMessages");
    const chatInput=document.getElementById("chatInput");

    function addChatMessage(text,isUser){
      const div=document.createElement("div");
      div.className=`message ${isUser?'user':'bot'}`;
      div.innerHTML=`<div class="message-content">${text}</div>`;
      chatMessages.appendChild(div);
      chatMessages.scrollTop=chatMessages.scrollHeight;
    }

    async function sendMessage(){
      const msg=chatInput.value.trim();
      if(!msg) return;
      addChatMessage(msg,true);
      chatInput.value="";
      const loading=document.createElement("div");
      loading.className="message bot";
      loading.innerHTML=`<div class="message-content loading">
        <div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div>
      </div>`;
      chatMessages.appendChild(loading);
      try{
        const res=await fetch(`${API_URL}/chat`,{
          method:"POST",headers:{'Content-Type':'application/json'},
          body:JSON.stringify({message:msg})
        });
        const data=await res.json();
        loading.remove();
        addChatMessage(data.response||"‚ö†Ô∏è No response.",false);
      }catch{
        loading.remove();
        addChatMessage("‚ùå Could not connect to backend.",false);
      }
    }

    // ---- Voice Recognition ----
    const micBtn=document.getElementById("micBtn");
    let recognition;
    if("webkitSpeechRecognition" in window){
      recognition=new webkitSpeechRecognition();
      recognition.continuous=false;
      recognition.lang="en-IN";
      recognition.interimResults=false;
      recognition.onstart=()=>micBtn.classList.add("active");
      recognition.onend=()=>micBtn.classList.remove("active");
      recognition.onresult=function(e){
        const transcript=e.results[0][0].transcript;
        chatInput.value=transcript;
        sendMessage();
      };
      micBtn.onclick=()=>recognition.start();
    }else{
      micBtn.disabled=true;
      micBtn.title="Speech recognition not supported";
    }

    // ---- Tracker Logic ----
    let transactions=JSON.parse(localStorage.getItem("transactions"))||[];
    function addTransaction(){
      const desc=description.value, amt=parseFloat(amount.value),
            type=document.getElementById("type").value, date=document.getElementById("date").value;
      if(!desc||!amt) return alert("Fill all fields!");
      transactions.push({id:Date.now(),description:desc,amount:amt,type,date});
      localStorage.setItem("transactions",JSON.stringify(transactions));
      description.value=""; amount.value=""; updateTracker();
    }
    function deleteTransaction(id){
      transactions=transactions.filter(t=>t.id!==id);
      localStorage.setItem("transactions",JSON.stringify(transactions));
      updateTracker();
    }
    function updateTracker(){
      const list=document.getElementById("transactionList");
      list.innerHTML="";
      let income=0,expense=0;
      transactions.forEach(t=>{
        if(t.type==="income") income+=t.amount; else expense+=t.amount;
        list.innerHTML+=`
          <div class="transaction-item">
            <div>
              <div class="transaction-type ${t.type}">${t.description}</div>
              <small>${new Date(t.date).toLocaleDateString()}</small>
            </div>
            <div>
              <div class="transaction-amount ${t.type}">
                ${t.type==="income"?'+':'-'}‚Çπ${t.amount}
              </div>
              <button class="delete-btn" onclick="deleteTransaction(${t.id})">√ó</button>
            </div>
          </div>`;
      });
      totalIncome.textContent=`‚Çπ${income.toFixed(2)}`;
      totalExpense.textContent=`‚Çπ${expense.toFixed(2)}`;
      balance.textContent=`‚Çπ${(income-expense).toFixed(2)}`;
    }
    updateTracker();
  </script>
</body>
</html>
